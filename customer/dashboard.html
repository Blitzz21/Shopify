<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Dashboard - GameDayTees</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl font-bold text-gray-900">Customer Dashboard</h1>
                <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
                    Logout
                </button>
            </div>
        </div>
    </header>
    
    <main class="max-w-7xl mx-auto px-4 py-8">
        <div class="bg-white rounded-lg shadow-sm p-6">
            <h2 class="text-xl font-semibold mb-4">Welcome to your Customer Dashboard!</h2>
            <p class="text-gray-600">You are successfully logged in as a customer.</p>
            <div class="mt-4">
                <p id="userInfo" class="text-sm text-gray-500"></p>
            </div>
        </div>
    </main>

    <script>
        const API_BASE = 'http://localhost/Shopify/backend/api';

        async function logout() {
            try {
                await fetch(`${API_BASE}/logout.php`, {
                    method: 'POST',
                    credentials: 'include',
                });
            } catch (e) {
                console.error('Logout API error (will still clear local state):', e);
            }

            localStorage.removeItem('user');
            localStorage.removeItem('isLoggedIn');

            window.location.href = '/Shopify/login.html';
        }

        async function loadCustomerDashboard() {
            try {
                const res = await fetch(`${API_BASE}/check-auth.php`, {
                    method: 'GET',
                    credentials: 'include',
                });

                const data = await res.json();

                if (!data.success || !data.data) {
                    // Not logged in
                    localStorage.removeItem('user');
                    localStorage.removeItem('isLoggedIn');
                    window.location.href = '/Shopify/login.html';
                    return;
                }

                // For now, any logged-in user can view customer dashboard
                localStorage.setItem('user', JSON.stringify(data.data));
                localStorage.setItem('isLoggedIn', 'true');

                document.getElementById('userInfo').textContent =
                    `Logged in as: ${data.data.name} (${data.data.email}) - Role: ${data.data.role}`;
            } catch (e) {
                console.error('check-auth failed:', e);
                localStorage.removeItem('user');
                localStorage.removeItem('isLoggedIn');
                window.location.href = '/Shopify/login.html';
            }
        }

        document.addEventListener('DOMContentLoaded', loadCustomerDashboard);
    </script>

</body>
</html>